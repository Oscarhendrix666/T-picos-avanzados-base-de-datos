DROP TABLE PUERTAS CASCADE CONSTRAINTS;
DROP TABLE VUELOS CASCADE CONSTRAINTS;
DROP TABLE USUARIOS CASCADE CONSTRAINTS;
DROP TABLE RESERVAS CASCADE CONSTRAINTS;
DROP TABLE PASAJEROS CASCADE CONSTRAINTS;
DROP TABLE AVIONES CASCADE CONSTRAINTS;
DROP TABLE EQUIPAJE CASCADE CONSTRAINTS;
DROP TABLE CHECKIN CASCADE CONSTRAINTS;
DROP TABLE ASIENTOS CASCADE CONSTRAINTS;


CREATE TABLE PUERTAS (
    ID_PUERTA NUMBER PRIMARY KEY,
    NUMERO_PUERTA VARCHAR2(5) UNIQUE NOT NULL,
    ESTADO VARCHAR2(10) CHECK (ESTADO IN ('Libre', 'Ocupada')) NOT NULL
);

CREATE TABLE VUELOS (
    ID_VUELO NUMBER PRIMARY KEY,
    NUMERO_VUELO VARCHAR2(10) UNIQUE NOT NULL,
    CIUDAD_ORIGEN VARCHAR2(100) NOT NULL,
    CIUDAD_DESTINO VARCHAR2(100) NOT NULL,
    HORA_SALIDA TIMESTAMP NOT NULL,
    HORA_LLEGADA TIMESTAMP NOT NULL,
    ESTADO VARCHAR2(20) CHECK (ESTADO IN ('Programado', 'Cancelado', 'Demorado', 'En Embarque')) NOT NULL,
    ID_AVION NUMBER NOT NULL,
    CONSTRAINT FK_VUELO_AVION FOREIGN KEY (ID_AVION) REFERENCES AVIONES(ID_AVION) ON DELETE CASCADE
);

CREATE TABLE USUARIOS (
    ID_USUARIO NUMBER PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL,
    CORREO VARCHAR2(100) UNIQUE NOT NULL,
    CONTRASEÃ‘A VARCHAR2(100) NOT NULL,
    ROL VARCHAR2(20) CHECK (ROL IN ('Cliente', 'Empleado', 'Administrador')) NOT NULL
);

CREATE TABLE RESERVAS (
    ID_RESERVA NUMBER PRIMARY KEY,
    ID_PASAJERO NUMBER NOT NULL,
    ID_VUELO NUMBER NOT NULL,
    NUMERO_ASIENTO VARCHAR2(5) NOT NULL,
    ESTADO VARCHAR2(20) DEFAULT 'Pendiente' CHECK (ESTADO IN ('Pendiente', 'Confirmado', 'Cancelado')),
    FECHA_RESERVA DATE DEFAULT SYSDATE,
    CODIGO_COMPRA NUMBER,
    CONSTRAINT FK_RESERVAS_PASAJERO FOREIGN KEY (ID_PASAJERO) REFERENCES PASAJEROS(ID_PASAJERO) ON DELETE CASCADE,
    CONSTRAINT FK_RESERVAS_VUELO FOREIGN KEY (ID_VUELO) REFERENCES VUELOS(ID_VUELO) ON DELETE CASCADE,
    CONSTRAINT UQ_ASIENTO UNIQUE (ID_VUELO, NUMERO_ASIENTO)
);

CREATE TABLE PASAJEROS (
    ID_PASAJERO NUMBER PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL,
    APELLIDO VARCHAR2(50) NOT NULL,
    NUMERO_PASAPORTE VARCHAR2(20) UNIQUE NOT NULL,
    CORREO VARCHAR2(100) UNIQUE NOT NULL
);

CREATE TABLE AVIONES (
    ID_AVION NUMBER PRIMARY KEY,
    MODELO VARCHAR2(50) NOT NULL,
    CAPACIDAD NUMBER CHECK (CAPACIDAD > 0) NOT NULL
);

CREATE TABLE EQUIPAJE (
    ID_EQUIPAJE NUMBER PRIMARY KEY,
    ID_RESERVA NUMBER NOT NULL,
    TIPO VARCHAR2(50) NOT NULL,
    PESO NUMBER(5,2) CHECK (PESO > 0) NOT NULL,
    CONSTRAINT FK_EQUIPAJE_RESERVA FOREIGN KEY (ID_RESERVA) REFERENCES RESERVAS(ID_RESERVA) ON DELETE CASCADE
);

CREATE TABLE CHECKIN (
    ID_CHECKIN NUMBER PRIMARY KEY,
    ID_RESERVA NUMBER NOT NULL,
    FECHA_CHECKIN TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    ID_PUERTA NUMBER NOT NULL,
    CONSTRAINT FK_CHECKIN_RESERVA FOREIGN KEY (ID_RESERVA) REFERENCES RESERVAS(ID_RESERVA) ON DELETE CASCADE,
    CONSTRAINT FK_CHECKIN_PUERTA FOREIGN KEY (ID_PUERTA) REFERENCES PUERTAS(ID_PUERTA)
);

CREATE TABLE ASIENTOS (
    ID_ASIENTO NUMBER PRIMARY KEY,
    ID_VUELO NUMBER NOT NULL,
    NUMERO_ASIENTO VARCHAR2(5) NOT NULL,
    ESTADO VARCHAR2(20) DEFAULT 'Libre' CHECK (ESTADO IN ('Libre', 'Reservado', 'Ocupado')),
    CONSTRAINT FK_ASIENTOS_VUELO FOREIGN KEY (ID_VUELO) REFERENCES VUELOS(ID_VUELO) ON DELETE CASCADE
);